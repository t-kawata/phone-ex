import{c as L,h as Y,p as W,q as X,e as J,Q as d}from"./QBtn.33f4eb89.js";import{i as I,q as k,s as Z,G as x,c as a,h as v,g as V,d as H,I as U,S as ee,_ as Q,J as m,K as N,M as s,ae as _,f as i,V as te,Y as C,Z as A,X as g,L as u,D as S,F as se,af as ne,$ as re}from"./index.28b1fc1c.js";import{a as ie,c as le,o as l,E as c,p as ae,m as oe,Q as q,l as y,r as $,q as R,n as D,C as T}from"./index.313db9b8.js";import"./axios.6e1fcf85.js";var ue=L({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:r}}=V(),n=I(Z,k);if(n===k)return console.error("QPage needs to be a deep child of QLayout"),k;if(I(x,k)===k)return console.error("QPage needs to be child of QPageContainer"),k;const f=a(()=>{const p=(n.header.space===!0?n.header.size:0)+(n.footer.space===!0?n.footer.size:0);if(typeof e.styleFn=="function"){const b=n.isContainer.value===!0?n.containerHeight.value:r.screen.height;return e.styleFn(p,b)}return{minHeight:n.isContainer.value===!0?n.containerHeight.value-p+"px":r.screen.height===0?p!==0?`calc(100vh - ${p}px)`:"100vh":r.screen.height-p+"px"}}),o=a(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>v("main",{class:o.value,style:f.value},Y(t.default))}});const de={xs:2,sm:4,md:6,lg:10,xl:14};function O(e,t,r){return{transform:t===!0?`translateX(${r.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var ce=L({name:"QLinearProgress",props:{...ie,...W,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:r}=V(),n=le(e,r.$q),h=X(e,de),f=a(()=>e.indeterminate===!0||e.query===!0),o=a(()=>e.reverse!==e.query),p=a(()=>({...h.value!==null?h.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),b=a(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),G=a(()=>O(e.buffer!==void 0?e.buffer:1,o.value,r.$q)),E=a(()=>`with${e.instantFeedback===!0?"out":""}-transition`),M=a(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${E.value} q-linear-progress__track--${n.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),F=a(()=>O(f.value===!0?1:e.value,o.value,r.$q)),K=a(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${E.value} q-linear-progress__model--${f.value===!0?"in":""}determinate`),j=a(()=>({width:`${e.value*100}%`})),z=a(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${E.value}`);return()=>{const B=[v("div",{class:M.value,style:G.value}),v("div",{class:K.value,style:F.value})];return e.stripe===!0&&f.value===!1&&B.push(v("div",{class:z.value,style:j.value})),v("div",{class:b.value,style:p.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},J(t.default,B))}}}),me="/assets/ringing.15605af0.mp3";const w="PREV_USER",P=new Audio(me),he=H({data(){return{number:"",customer:{},audioTest:!1,UA:{},UAStatus:l.UA_STATUS.UA_NOT_PREPARED,isDialogOpen:!1,isOpenConfirmDialog:!1,callerIdName:"",callerIdNum:"",isHolded:!1,isMuted:!1}},methods:{onClickCallBtn(){!this.isUAPrepared()||this.UA.call(this.number)},onClickHangupBtn(){!this.isUAPrepared()||this.UA.hangup()},onClickMuteBtn(){!this.isUAPrepared()||(this.isMuted=!0,this.UA.mute())},onClickUnmuteBtn(){!this.isUAPrepared()||(this.isMuted=!1,this.UA.unmute())},onClickHoldBtn(){!this.isUAPrepared()||(this.isHolded=!0,this.UA.hold())},onClickUnholdBtn(){!this.isUAPrepared()||(this.isHolded=!1,this.UA.unhold())},onClickAcceptBtn(){!this.isUAPrepared()||this.UA.accept()},onClickRejectBtn(){!this.isUAPrepared()||this.UA.hangup()},onClickStartRingingTest(){let e=!0;this.startRinging().catch(()=>{e=!1}),setTimeout(()=>{this.stopRinging(),e&&(this.audioTest=!0)},3500)},onClickCustomerListCallBtn(e){const{detail:t}=e,{number:r}=t;this.number=r,this.onClickCallBtn()},isUAPrepared(){return Object.keys(this.UA).length>0},prevChk(e){const t=U.getItem(w);return t?!(Object.keys(t).length>0&&!(e.key!==t.key||e.host!==t.host||e.username!==t.username||e.password!==t.password)):!0},startRinging(){return P.play()},stopRinging(){P.pause(),P.currentTime=0},searchCustomer(e,t){if(this.customer={},!this.customers||this.customers.length===0)return;const r=this.customers.filter(n=>n.number===t||n.name===e);r.length!==0&&(this.customer=r[0])},init(e){const t={key:U.getItem("KEY")||"",host:U.getItem("HOST")||"",username:U.getItem("USERNAME")||"",password:U.getItem("PASSWORD")||""};!t.key||!t.host||!t.username||!t.password||e&&!this.prevChk(t)||(U.set(w,t),this.isUAPrepared()&&(this.UA.stop(),this.UA=null),this.UA=new l.AstUA({host:t.host,key:t.key,username:t.username,password:t.password,remoteVideo:document.getElementById("__ast-remote-video"),localVideo:document.getElementById("__ast-local-video"),register:!0,watchUsers:!0,watchQueues:!0,udp:!0,ualog:!1,siplog:!1}),this.UA.on(l.EVENT_TYPE.UA_STATE_CHANGE,r=>{const{UAStatus:n}=r.detail;this.UAStatus=n,c.dispatch(c.Type.OnUAStatusChange,n)}),this.UA.on(l.EVENT_TYPE.UA_BEING_CALLED,r=>{this.isDialogOpen=!0;const{callerIdName:n,callerIdNum:h}=r.detail;this.callerIdName=n,this.callerIdNum=h,this.searchCustomer(n,h)}),this.UA.on(l.EVENT_TYPE.UA_BEING_CALLED_ANSWER,()=>{}),this.UA.on(l.EVENT_TYPE.UA_BEING_CALLED_END,()=>{this.isDialogOpen=!1}))}},computed:{...ee(ae,["customers"]),isProgressing(){return!(this.UAStatus===l.UA_STATUS.UA_NOT_PREPARED||this.UAStatus===l.UA_STATUS.WAITING)},isCallable(){return this.UAStatus===l.UA_STATUS.WAITING},isToolable(){return this.UAStatus===l.UA_STATUS.TALKING||this.UAStatus===l.UA_STATUS.HOLDING||this.UAStatus===l.UA_STATUS.HOLDED},isEndable(){return this.UAStatus===l.UA_STATUS.CALLING||this.UAStatus===l.UA_STATUS.BRIDGING||this.UAStatus===l.UA_STATUS.TALKING||this.UAStatus===l.UA_STATUS.HOLDING||this.UAStatus===l.UA_STATUS.HOLDED},isReady(){return this.UAStatus!==l.UA_STATUS.UA_NOT_PREPARED}},watch:{isDialogOpen(e){e?this.startRinging().catch(t=>{console.log(t)}):this.stopRinging()}},mounted(){this.init(!1),setInterval(()=>{this.init(!0)},3e3),c.on(c.Type.OnClickCustomerListCallBtn,this.onClickCustomerListCallBtn),c.on(c.Type.OnClickStartRingingTest,this.onClickStartRingingTest),this.isOpenConfirmDialog=!0},unmounted(){c.off(c.Type.OnClickCustomerListCallBtn,this.onClickCustomerListCallBtn),c.off(c.Type.OnClickStartRingingTest,this.onClickStartRingingTest)}}),ge={class:"phone-box"},fe={class:"account-status flex"},pe={class:"text-center q-ma-md"},Ce=s("span",{class:"q-ml-sm text-h6"},"\u7740\u4FE1\u4E2D\u3067\u3059",-1),Ae={class:"full-width"},ke=s("th",{class:"text-left"},"\u767A\u4FE1\u8005\u540D",-1),Ue=s("th",{class:"text-left"},"\u767A\u4FE1\u8005\u756A\u53F7",-1),_e={class:"info-box bg-grey-3 q-pa-sm"},ve={key:0},Se={key:1},ye=s("th",{style:{"min-width":"50px"}},"\u540D\u524D",-1),Te=s("th",null,"\u756A\u53F7",-1),be=s("th",null,"\u60C5\u5831",-1),Ee=s("span",{class:"q-ml-sm"},"\u7740\u4FE1\u97F3\u306E\u30C6\u30B9\u30C8\u3092\u958B\u59CB\u3057\u3066\u3082\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F",-1),Ne=ne('<div style="display:none;"><video id="__ast-remote-video"><track kind="captions"></video><video id="__ast-local-video" muted><track kind="captions"></video></div>',1);function Pe(e,t,r,n,h,f){return m(),N(se,null,[s("div",{class:_(["phone-page-container relative-position",e.isProgressing?"bg-grey-2":""])},[s("div",{class:_(e.isProgressing?"calling":"none")},[i(ce,{dark:"",rounded:"",indeterminate:"",color:"cyan"})],2),s("div",ge,[s("div",fe,[s("span",{class:_(["badge",e.isReady?"ready":"none"])},"\xA0",2),s("p",null,[te(C(e.isReady?"\u8A8D\u8A3C\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F":"\u8A8D\u8A3C\u304C\u5931\u6557\u3057\u307E\u3057\u305F")+" ",1),s("span",{class:_(["q-mx-sm",e.audioTest?"green":"red"])}," ["+C(e.audioTest?"\u7740\u4FE1\u97F3\u30C6\u30B9\u30C8OK":"\u7740\u4FE1\u97F3\u30C6\u30B9\u30C8NG")+"] ",3)])]),i(oe,{class:"number-input",rounded:"",outlined:"",modelValue:e.number,"onUpdate:modelValue":t[0]||(t[0]=o=>e.number=o),label:"Number"},null,8,["modelValue"]),s("div",pe,[e.isEndable?(m(),A(d,{key:0,round:"",color:"dark",icon:"call_end",onClick:e.onClickHangupBtn,class:_(e.isToolable?"q-mr-md":"")},null,8,["onClick","class"])):g("",!0),e.isToolable&&!e.isMuted?(m(),A(d,{key:1,round:"",icon:"volume_off",onClick:e.onClickMuteBtn,class:"q-mr-md"},null,8,["onClick"])):g("",!0),e.isToolable&&e.isMuted?(m(),A(d,{key:2,round:"",icon:"volume_up",onClick:e.onClickUnmuteBtn,class:"q-mr-md"},null,8,["onClick"])):g("",!0),e.isToolable&&!e.isHolded?(m(),A(d,{key:3,round:"",icon:"music_note",onClick:e.onClickHoldBtn,class:"q-mr-md"},null,8,["onClick"])):g("",!0),e.isToolable&&e.isHolded?(m(),A(d,{key:4,round:"",icon:"music_off",onClick:e.onClickUnholdBtn,class:"q-mr-md"},null,8,["onClick"])):g("",!0),e.isCallable?(m(),A(d,{key:5,round:"",icon:"call",onClick:e.onClickCallBtn},null,8,["onClick"])):g("",!0)])])],2),i(D,{modelValue:e.isDialogOpen,"onUpdate:modelValue":t[1]||(t[1]=o=>e.isDialogOpen=o),persistent:"",position:"right"},{default:u(()=>[i(q,{style:{width:"400px"}},{default:u(()=>[i(y,{class:"row items-center"},{default:u(()=>[i($,{icon:"ring_volume",class:"yureru-s"}),Ce]),_:1}),i(y,{class:"row items-center"},{default:u(()=>[s("table",Ae,[s("tr",null,[ke,s("td",null,C(e.callerIdName),1)]),s("tr",null,[Ue,s("td",null,C(e.callerIdNum),1)])])]),_:1}),i(y,null,{default:u(()=>[s("div",_e,[Object.keys(e.customer).length===0?(m(),N("div",ve," \u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u306B\u8A72\u5F53\u3059\u308B\u60C5\u5831\u304C\u3042\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ")):g("",!0),Object.keys(e.customer).length>0?(m(),N("div",Se,[s("table",null,[s("tr",null,[ye,s("td",null,C(e.customer.name),1)]),s("tr",null,[Te,s("td",null,C(e.customer.number),1)]),s("tr",null,[be,s("td",null,C(e.customer.info),1)])])])):g("",!0)])]),_:1}),i(R,{align:"right"},{default:u(()=>[S(i(d,{label:"\u62D2\u5426\u3059\u308B",color:"dark",onClick:e.onClickRejectBtn},null,8,["onClick"]),[[T]]),S(i(d,{label:"\u96FB\u8A71\u306B\u51FA\u308B",onClick:e.onClickAcceptBtn},null,8,["onClick"]),[[T]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(D,{modelValue:e.isOpenConfirmDialog,"onUpdate:modelValue":t[2]||(t[2]=o=>e.isOpenConfirmDialog=o),persistent:""},{default:u(()=>[i(q,null,{default:u(()=>[i(y,{class:"row items-center"},{default:u(()=>[i($,{icon:"phone_in_talk",color:"primary","text-color":"white"}),Ee]),_:1}),i(R,{align:"right"},{default:u(()=>[S(i(d,{label:"\u62D2\u5426\u3059\u308B",color:"primary"},null,512),[[T]]),S(i(d,{label:"\u7740\u4FE1\u97F3\u30C6\u30B9\u30C8\u3092\u958B\u59CB\u3059\u308B",onClick:e.onClickStartRingingTest},null,8,["onClick"]),[[T]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Ne],64)}var Be=Q(he,[["render",Pe]]);const Ie=H({components:{SimplePhone:Be}});function qe(e,t,r,n,h,f){const o=re("SimplePhone");return m(),A(ue,null,{default:u(()=>[i(o)]),_:1})}var we=Q(Ie,[["render",qe]]);export{we as default};
